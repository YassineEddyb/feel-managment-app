{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,2JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,qIAAA,CAAA,OAAI,AAAD,EAAE;AACtB","debugId":null}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/components/ui/dialog.tsx"],"sourcesContent":["import { cn } from \"@/lib/utils\";\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport { X } from \"lucide-react\";\nimport * as React from \"react\";\n\nconst Dialog = DialogPrimitive.Root;\n\nconst DialogTrigger = DialogPrimitive.Trigger;\n\nconst DialogPortal = DialogPrimitive.Portal;\n\nconst DialogClose = DialogPrimitive.Close;\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n));\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName;\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-neutral-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full dark:border-neutral-800 dark:bg-neutral-950\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-neutral-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-neutral-100 data-[state=open]:text-neutral-500 dark:ring-offset-neutral-950 dark:focus:ring-neutral-300 dark:data-[state=open]:bg-neutral-800 dark:data-[state=open]:text-neutral-400\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n));\nDialogContent.displayName = DialogPrimitive.Content.displayName;\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n);\nDialogHeader.displayName = \"DialogHeader\";\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n);\nDialogFooter.displayName = \"DialogFooter\";\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n));\nDialogTitle.displayName = DialogPrimitive.Title.displayName;\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-neutral-500 dark:text-neutral-400\", className)}\n    {...props}\n  />\n));\nDialogDescription.displayName = DialogPrimitive.Description.displayName;\n\nexport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,SAAS,kKAAA,CAAA,OAAoB;AAEnC,MAAM,gBAAgB,kKAAA,CAAA,UAAuB;AAE7C,MAAM,eAAe,kKAAA,CAAA,SAAsB;AAE3C,MAAM,cAAc,kKAAA,CAAA,QAAqB;AAEzC,MAAM,8BAAgB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,UAAuB;QACtB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,0JACA;QAED,GAAG,KAAK;;;;;;AAGb,cAAc,WAAW,GAAG,kKAAA,CAAA,UAAuB,CAAC,WAAW;AAE/D,MAAM,8BAAgB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGnC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,8OAAC;;0BACC,8OAAC;;;;;0BACD,8OAAC,kKAAA,CAAA,UAAuB;gBACtB,KAAK;gBACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,mkBACA;gBAED,GAAG,KAAK;;oBAER;kCACD,8OAAC,kKAAA,CAAA,QAAqB;wBAAC,WAAU;;0CAC/B,8OAAC,4LAAA,CAAA,IAAC;gCAAC,WAAU;;;;;;0CACb,8OAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAKlC,cAAc,WAAW,GAAG,kKAAA,CAAA,UAAuB,CAAC,WAAW;AAE/D,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,aAAa,WAAW,GAAG;AAE3B,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,iEACA;QAED,GAAG,KAAK;;;;;;AAGb,aAAa,WAAW,GAAG;AAE3B,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,qDACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,kKAAA,CAAA,QAAqB,CAAC,WAAW;AAE3D,MAAM,kCAAoB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGvC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,kKAAA,CAAA,cAA2B;QAC1B,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,kDAAkD;QAC/D,GAAG,KAAK;;;;;;AAGb,kBAAkB,WAAW,GAAG,kKAAA,CAAA,cAA2B,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/components/dashboard/VehicleDetails.tsx"],"sourcesContent":["import {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { VehicleDetails as VehicleDetailsType } from \"@/types/vehicle\";\nimport {\n  AlertCircle,\n  Anchor,\n  ArrowUpDown,\n  Battery,\n  Clock,\n  Droplets,\n  Fuel,\n  Gauge,\n  Info,\n  MapPin,\n  Navigation,\n  Power,\n  Ruler,\n  Satellite,\n  Thermometer,\n  X,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\ninterface VehicleDetailsProps {\n  isOpen: boolean;\n  onClose: () => void;\n  vehicleDetails: VehicleDetailsType | null;\n  isLoading: boolean;\n}\n\n// Helper function to format timestamp\nconst formatTimestamp = (timestamp: number): string => {\n  return new Date(timestamp).toLocaleString();\n};\n\n// Helper function to format telemetry values with units\nconst formatTelemetryValue = (key: string, value: any): string => {\n  if (value === undefined || value === null) return \"N/A\";\n\n  // Format based on the field name\n  switch (key.toLowerCase()) {\n    case \"altitude\":\n      return `${value} m`;\n    case \"temperature\":\n      return `${value} Â°C`;\n    case \"humidity\":\n      return `${value} %`;\n    case \"fuel\":\n      return `${value} %`;\n    case \"odometer\":\n    case \"distance\":\n      return `${value} km`;\n    case \"satellites\":\n      return value.toString();\n    case \"accuracy\":\n      return `${value} m`;\n    case \"hdop\":\n      return value.toString();\n    case \"ignition\":\n      return value ? \"On\" : \"Off\";\n    case \"engine\":\n      return value ? \"Running\" : \"Off\";\n    default:\n      return value.toString();\n  }\n};\n\n// Helper to get icon for telemetry field\nconst getTelemetryIcon = (key: string) => {\n  switch (key.toLowerCase()) {\n    case \"temperature\":\n      return <Thermometer className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"altitude\":\n      return <ArrowUpDown className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"satellites\":\n      return <Satellite className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"fuel\":\n      return <Fuel className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"ignition\":\n    case \"engine\":\n      return <Power className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"odometer\":\n    case \"distance\":\n      return <Ruler className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"humidity\":\n      return <Droplets className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    case \"hdop\":\n    case \"accuracy\":\n      return <Anchor className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n    default:\n      return <Info className=\"h-5 w-5 mr-2 text-neutral-500\" />;\n  }\n};\n\nexport default function VehicleDetails({\n  isOpen,\n  onClose,\n  vehicleDetails,\n  isLoading,\n}: VehicleDetailsProps) {\n  const [showAllTelemetry, setShowAllTelemetry] = useState(false);\n\n  // Log when the component updates\n  useEffect(() => {\n    if (isOpen) {\n      console.log(\"Vehicle details dialog opened\", {\n        isOpen,\n        vehicleDetails,\n        isLoading,\n      });\n    }\n  }, [isOpen, vehicleDetails, isLoading]);\n\n  // Get additional telemetry fields\n  const getAdditionalTelemetry = () => {\n    if (!vehicleDetails?.additionalTelemetry) return [];\n\n    return Object.entries(vehicleDetails.additionalTelemetry)\n      .filter(([_, value]) => value !== undefined && value !== null)\n      .sort(([a], [b]) => a.localeCompare(b));\n  };\n\n  const additionalTelemetry = vehicleDetails ? getAdditionalTelemetry() : [];\n\n  // Handle dialog state changes\n  const handleOpenChange = (open: boolean) => {\n    if (!open) {\n      onClose();\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"max-w-md max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle>\n              {vehicleDetails ? vehicleDetails.name : \"Vehicle Details\"}\n            </DialogTitle>\n            <button\n              onClick={onClose}\n              className=\"rounded-full p-1 hover:bg-neutral-100\"\n            >\n              <X className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"flex flex-col space-y-3 py-4\">\n            <div className=\"h-6 bg-neutral-100 animate-pulse rounded\"></div>\n            <div className=\"h-6 bg-neutral-100 animate-pulse rounded\"></div>\n            <div className=\"h-6 bg-neutral-100 animate-pulse rounded\"></div>\n          </div>\n        ) : vehicleDetails ? (\n          <div className=\"flex flex-col space-y-4 py-4\">\n            <div className=\"flex items-center\">\n              <MapPin className=\"h-5 w-5 mr-2 text-neutral-500\" />\n              <span className=\"font-medium\">Location:</span>\n              <span className=\"ml-2 text-sm\">\n                {vehicleDetails.lat.toFixed(6)}, {vehicleDetails.lng.toFixed(6)}\n              </span>\n            </div>\n\n            <div className=\"flex items-center\">\n              <Gauge className=\"h-5 w-5 mr-2 text-neutral-500\" />\n              <span className=\"font-medium\">Speed:</span>\n              <span className=\"ml-2\">{vehicleDetails.speed} km/h</span>\n            </div>\n\n            {vehicleDetails.heading !== undefined && (\n              <div className=\"flex items-center\">\n                <Navigation className=\"h-5 w-5 mr-2 text-neutral-500\" />\n                <span className=\"font-medium\">Heading:</span>\n                <span className=\"ml-2\">\n                  {Math.round(vehicleDetails.heading)}Â°\n                </span>\n              </div>\n            )}\n\n            <div className=\"flex items-center\">\n              <Battery className=\"h-5 w-5 mr-2 text-neutral-500\" />\n              <span className=\"font-medium\">Battery:</span>\n              <div className=\"ml-2 w-24 bg-neutral-200 rounded-full h-2.5 dark:bg-neutral-700\">\n                <div\n                  className={`h-2.5 rounded-full ${\n                    vehicleDetails.battery > 20 ? \"bg-green-600\" : \"bg-red-600\"\n                  }`}\n                  style={{ width: `${vehicleDetails.battery}%` }}\n                ></div>\n              </div>\n              <span className=\"ml-2\">{vehicleDetails.battery}%</span>\n            </div>\n\n            <div className=\"flex items-center\">\n              <Clock className=\"h-5 w-5 mr-2 text-neutral-500\" />\n              <span className=\"font-medium\">Last updated:</span>\n              <span className=\"ml-2\">\n                {formatTimestamp(vehicleDetails.timestamp)}\n              </span>\n            </div>\n\n            {additionalTelemetry.length > 0 && (\n              <div className=\"mt-4\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h3 className=\"text-sm font-semibold text-neutral-700\">\n                    Additional Telemetry\n                  </h3>\n                  <button\n                    onClick={() => setShowAllTelemetry(!showAllTelemetry)}\n                    className=\"text-xs text-blue-600 hover:text-blue-800\"\n                  >\n                    {showAllTelemetry ? \"Show Less\" : \"Show All\"}\n                  </button>\n                </div>\n\n                <div className=\"space-y-2 border-t pt-2\">\n                  {additionalTelemetry\n                    .slice(0, showAllTelemetry ? undefined : 3)\n                    .map(([key, value]) => (\n                      <div key={key} className=\"flex items-center\">\n                        {getTelemetryIcon(key)}\n                        <span className=\"font-medium capitalize\">\n                          {key.replace(\"_\", \" \")}:\n                        </span>\n                        <span className=\"ml-2\">\n                          {formatTelemetryValue(key, value)}\n                        </span>\n                      </div>\n                    ))}\n\n                  {!showAllTelemetry && additionalTelemetry.length > 3 && (\n                    <div className=\"text-xs text-center text-neutral-500\">\n                      + {additionalTelemetry.length - 3} more fields\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n        ) : (\n          <div className=\"flex items-center justify-center p-6\">\n            <AlertCircle className=\"h-6 w-6 text-red-500 mr-2\" />\n            <span>No vehicle data available</span>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 734, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/components/dashboard/VehicleMap.tsx"],"sourcesContent":["import { VehiclePosition } from \"@/types/vehicle\";\nimport \"leaflet/dist/leaflet.css\";\nimport dynamic from \"next/dynamic\";\nimport { useEffect, useState } from \"react\";\n\n// Dynamically import Leaflet components to avoid SSR issues\nconst MapContainer = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.MapContainer),\n  { ssr: false }\n);\nconst TileLayer = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.TileLayer),\n  { ssr: false }\n);\nconst Marker = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.Marker),\n  { ssr: false }\n);\nconst Popup = dynamic(() => import(\"react-leaflet\").then((mod) => mod.Popup), {\n  ssr: false,\n});\n\ninterface VehicleMapProps {\n  vehicles: VehiclePosition[];\n  onVehicleClick: (id: string) => void;\n}\n\nexport default function VehicleMap({\n  vehicles,\n  onVehicleClick,\n}: VehicleMapProps) {\n  // Use the first vehicle's position as center if available, otherwise use default\n  const mapCenter =\n    vehicles.length > 0\n      ? { lat: vehicles[0].lat, lng: vehicles[0].lng }\n      : { lat: 32.219143, lng: -7.936173 };\n\n  // State for Leaflet library\n  const [L, setL] = useState<any>(null);\n\n  useEffect(() => {\n    // Import Leaflet on client-side only\n    import(\"leaflet\").then((leaflet) => {\n      setL(leaflet);\n\n      // Add CSS for vehicle markers\n      const style = document.createElement(\"style\");\n      style.textContent = `\n        .vehicle-marker {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        .vehicle-marker img {\n          width: 32px;\n          height: 20px;\n        }\n      `;\n      document.head.appendChild(style);\n    });\n  }, []);\n\n  if (!L) {\n    return (\n      <div className=\"h-full w-full bg-neutral-100 animate-pulse rounded-lg\"></div>\n    );\n  }\n\n  // Check if a vehicle is static based on its ID\n  const isStaticVehicle = (id: string) => id.startsWith(\"static\");\n\n  // Create a vehicle icon with the correct rotation\n  const createVehicleIcon = (vehicle: VehiclePosition) => {\n    const heading = vehicle.heading || 0;\n    const isStatic = isStaticVehicle(vehicle.id);\n    const iconPath = isStatic\n      ? \"/icons/golf-cart.png\"\n      : \"/icons/golf-cart-3.png\";\n\n    // Create a div-based icon that we can rotate\n    return new L.DivIcon({\n      html: `<div style=\"transform: rotate(${heading}deg);\"><img src=\"${iconPath}\" alt=\"Vehicle\" /></div>`,\n      className: \"vehicle-marker\",\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n      popupAnchor: [0, -16],\n    });\n  };\n\n  return (\n    <div className=\"h-[calc(100vh-30px)] w-full rounded-lg overflow-hidden \">\n      <MapContainer\n        center={mapCenter}\n        zoom={18}\n        style={{ height: \"100%\", width: \"100%\" }}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png\"\n        />\n        {vehicles.map((vehicle) => {\n          const vehicleIcon = createVehicleIcon(vehicle);\n          const isStatic = isStaticVehicle(vehicle.id);\n\n          return (\n            <Marker\n              key={vehicle.id}\n              position={[vehicle.lat, vehicle.lng]}\n              icon={vehicleIcon}\n              eventHandlers={{\n                click: () => {\n                  // We don't need to call onVehicleClick here as it will be called from the button\n                  // This prevents double trigger, letting the popup open first\n                },\n              }}\n            >\n              <Popup>\n                <div className=\"p-1\">\n                  <div className=\"font-bold\">{vehicle.name}</div>\n                  <div className=\"text-xs text-gray-600\">\n                    Heading: {Math.round(vehicle.heading || 0)}Â°\n                  </div>\n                  {isStatic && (\n                    <div className=\"text-xs text-blue-600 mt-1\">\n                      Static Vehicle\n                    </div>\n                  )}\n                </div>\n              </Popup>\n            </Marker>\n          );\n        })}\n      </MapContainer>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;;;;;;;;AAEA,4DAA4D;AAC5D,MAAM,eAAe,CAAA,GAAA,+JAAA,CAAA,UAAO,AAAD;;;;;;IAEvB,KAAK;;AAET,MAAM,YAAY,CAAA,GAAA,+JAAA,CAAA,UAAO,AAAD;;;;;;IAEpB,KAAK;;AAET,MAAM,SAAS,CAAA,GAAA,+JAAA,CAAA,UAAO,AAAD;;;;;;IAEjB,KAAK;;AAET,MAAM,QAAQ,CAAA,GAAA,+JAAA,CAAA,UAAO,AAAD;;;;;;IAClB,KAAK;;AAQQ,SAAS,WAAW,EACjC,QAAQ,EACR,cAAc,EACE;IAChB,iFAAiF;IACjF,MAAM,YACJ,SAAS,MAAM,GAAG,IACd;QAAE,KAAK,QAAQ,CAAC,EAAE,CAAC,GAAG;QAAE,KAAK,QAAQ,CAAC,EAAE,CAAC,GAAG;IAAC,IAC7C;QAAE,KAAK;QAAW,KAAK,CAAC;IAAS;IAEvC,4BAA4B;IAC5B,MAAM,CAAC,GAAG,KAAK,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAO;IAEhC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,qCAAqC;QACrC,4IAAkB,IAAI,CAAC,CAAC;YACtB,KAAK;YAEL,8BAA8B;YAC9B,MAAM,QAAQ,SAAS,aAAa,CAAC;YACrC,MAAM,WAAW,GAAG,CAAC;;;;;;;;;;MAUrB,CAAC;YACD,SAAS,IAAI,CAAC,WAAW,CAAC;QAC5B;IACF,GAAG,EAAE;IAEL,IAAI,CAAC,GAAG;QACN,qBACE,8OAAC;YAAI,WAAU;;;;;;IAEnB;IAEA,+CAA+C;IAC/C,MAAM,kBAAkB,CAAC,KAAe,GAAG,UAAU,CAAC;IAEtD,kDAAkD;IAClD,MAAM,oBAAoB,CAAC;QACzB,MAAM,UAAU,QAAQ,OAAO,IAAI;QACnC,MAAM,WAAW,gBAAgB,QAAQ,EAAE;QAC3C,MAAM,WAAW,WACb,yBACA;QAEJ,6CAA6C;QAC7C,OAAO,IAAI,EAAE,OAAO,CAAC;YACnB,MAAM,CAAC,8BAA8B,EAAE,QAAQ,iBAAiB,EAAE,SAAS,wBAAwB,CAAC;YACpG,WAAW;YACX,UAAU;gBAAC;gBAAI;aAAG;YAClB,YAAY;gBAAC;gBAAI;aAAG;YACpB,aAAa;gBAAC;gBAAG,CAAC;aAAG;QACvB;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YACC,QAAQ;YACR,MAAM;YACN,OAAO;gBAAE,QAAQ;gBAAQ,OAAO;YAAO;;8BAEvC,8OAAC;oBACC,aAAY;oBACZ,KAAI;;;;;;gBAEL,SAAS,GAAG,CAAC,CAAC;oBACb,MAAM,cAAc,kBAAkB;oBACtC,MAAM,WAAW,gBAAgB,QAAQ,EAAE;oBAE3C,qBACE,8OAAC;wBAEC,UAAU;4BAAC,QAAQ,GAAG;4BAAE,QAAQ,GAAG;yBAAC;wBACpC,MAAM;wBACN,eAAe;4BACb,OAAO;4BACL,iFAAiF;4BACjF,6DAA6D;4BAC/D;wBACF;kCAEA,cAAA,8OAAC;sCACC,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDAAa,QAAQ,IAAI;;;;;;kDACxC,8OAAC;wCAAI,WAAU;;4CAAwB;4CAC3B,KAAK,KAAK,CAAC,QAAQ,OAAO,IAAI;4CAAG;;;;;;;oCAE5C,0BACC,8OAAC;wCAAI,WAAU;kDAA6B;;;;;;;;;;;;;;;;;uBAjB7C,QAAQ,EAAE;;;;;gBAyBrB;;;;;;;;;;;;AAIR","debugId":null}},
    {"offset": {"line": 1050, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/lib/api.ts"],"sourcesContent":["import { VehicleDetails, VehiclePosition } from \"@/types/vehicle\";\nimport axios from \"axios\";\n\n// Flespi API token\nconst FLESPI_TOKEN =\n  \"XerK3k3u8kjS3gcwwluEcxSv7LJem1Zxn3MlB4eGd7BgENdnKzrbVTJfvx2o6m5I\";\n\n// Flespi API client\nconst flespiApi = axios.create({\n  baseURL: \"https://flespi.io\",\n  headers: {\n    Authorization: `FlespiToken ${FLESPI_TOKEN}`,\n  },\n});\n\n// Mock data for fallback\nconst MOCK_VEHICLES: VehiclePosition[] = [\n  { id: \"1\", name: \"Truck 1\", lat: 32.219143, lng: -7.936173 },\n  { id: \"2\", name: \"Truck 2\", lat: 35.7806, lng: -78.6452 },\n  { id: \"3\", name: \"Van 1\", lat: 35.7756, lng: -78.6302 },\n  { id: \"4\", name: \"Car 1\", lat: 35.7846, lng: -78.6432 },\n];\n\n// Static vehicles to always include\nconst STATIC_VEHICLES: VehiclePosition[] = [\n  {\n    id: \"static1\",\n    name: \"Golfette_GEP 02\",\n    lat: 32.218543,\n    lng: -7.937073,\n    heading: 140,\n  },\n  {\n    id: \"static2\",\n    name: \"Golfette_GEP 03\",\n    lat: 32.219243,\n    lng: -7.935573,\n    heading: 140,\n  },\n  {\n    id: \"static3\",\n    name: \"Golfette_GEP 04\",\n    lat: 32.218851,\n    lng: -7.937073,\n    heading: 140,\n  },\n  {\n    id: \"static4\",\n    name: \"Golfette_GEP 05\",\n    lat: 32.219851,\n    lng: -7.937073,\n    heading: 140,\n  },\n];\n\n/**\n * Fetch all vehicle positions from Flespi API\n */\nexport const getAllVehiclesPositions = async (): Promise<VehiclePosition[]> => {\n  try {\n    // Get all devices\n    const devicesResponse = await flespiApi.get(\n      \"/gw/devices/all?fields=id,name\"\n    );\n\n    if (\n      !devicesResponse.data?.result ||\n      !Array.isArray(devicesResponse.data.result) ||\n      devicesResponse.data.result.length === 0\n    ) {\n      // Return mock vehicles combined with static vehicles\n      return [...MOCK_VEHICLES, ...STATIC_VEHICLES];\n    }\n\n    const devices = devicesResponse.data.result;\n    const vehiclesWithPosition: VehiclePosition[] = [];\n\n    // Process each device to get its telemetry\n    for (const device of devices) {\n      try {\n        const telemetryResponse = await flespiApi.get(\n          `/gw/devices/${device.id}/telemetry/all`\n        );\n\n        if (telemetryResponse.data?.result?.[0]?.telemetry) {\n          const telemetry = telemetryResponse.data.result[0].telemetry;\n\n          // Extract position data using the structure from the user's example\n          if (\n            telemetry.position?.value ||\n            (telemetry[\"position.latitude\"]?.value !== undefined &&\n              telemetry[\"position.longitude\"]?.value !== undefined)\n          ) {\n            // Get position data\n            const lat =\n              telemetry[\"position.latitude\"]?.value ??\n              telemetry.position?.value?.latitude ??\n              0;\n\n            const lng =\n              telemetry[\"position.longitude\"]?.value ??\n              telemetry.position?.value?.longitude ??\n              0;\n\n            // Get heading (direction)\n            const heading = telemetry[\"position.direction\"]?.value ?? 0;\n\n            // Only add vehicle if we have valid position data\n            if (lat && lng) {\n              vehiclesWithPosition.push({\n                id: String(device.id),\n                name:\n                  device.name ||\n                  telemetry[\"device.name\"]?.value ||\n                  `Vehicle ${device.id}`,\n                lat: parseFloat(String(lat)),\n                lng: parseFloat(String(lng)),\n                heading: parseFloat(String(heading)),\n              });\n            }\n          }\n        }\n      } catch (err) {\n        console.error(`Error fetching telemetry for device ${device.id}:`, err);\n      }\n    }\n\n    // Combine fetched vehicles with static vehicles\n    const allVehicles = [\n      ...(vehiclesWithPosition.length > 0\n        ? vehiclesWithPosition\n        : MOCK_VEHICLES),\n      ...STATIC_VEHICLES,\n    ];\n\n    return allVehicles;\n  } catch (error) {\n    console.error(\"Error fetching vehicle positions:\", error);\n    // Return mock vehicles combined with static vehicles\n    return [...MOCK_VEHICLES, ...STATIC_VEHICLES];\n  }\n};\n\n/**\n * Get detailed vehicle information for a specific vehicle\n */\nexport const getVehicleDetails = async (\n  vehicleId: string\n): Promise<VehicleDetails> => {\n  // Check if this is a static vehicle\n  const staticVehicle = STATIC_VEHICLES.find((v) => v.id === vehicleId);\n  if (staticVehicle) {\n    return {\n      id: staticVehicle.id,\n      name: staticVehicle.name,\n      lat: staticVehicle.lat,\n      lng: staticVehicle.lng,\n      speed: Math.floor(Math.random() * 25), // Random speed between 0-25 km/h\n      battery: 75 + Math.floor(Math.random() * 25), // Random battery between 75-100%\n      timestamp: Date.now(),\n      heading: staticVehicle.heading || 0,\n      additionalTelemetry: {\n        altitude: 100 + Math.floor(Math.random() * 50),\n        satellites: 8 + Math.floor(Math.random() * 4),\n        gsm_signal: 80 + Math.floor(Math.random() * 20),\n        movement: Math.random() > 0.3 ? \"moving\" : \"stationary\",\n      },\n    };\n  }\n\n  try {\n    // Get telemetry data for the specific device\n    const telemetryResponse = await flespiApi.get(\n      `/gw/devices/${vehicleId}/telemetry/all`\n    );\n\n    if (telemetryResponse.data?.result?.[0]?.telemetry) {\n      const telemetry = telemetryResponse.data.result[0].telemetry;\n\n      // Get the device name\n      let name = telemetry[\"device.name\"]?.value || `Vehicle ${vehicleId}`;\n\n      // Extract basic position data\n      const lat = telemetry[\"position.latitude\"]?.value ?? 0;\n      const lng = telemetry[\"position.longitude\"]?.value ?? 0;\n      const heading = telemetry[\"position.direction\"]?.value ?? 0;\n      const speed = telemetry[\"position.speed\"]?.value ?? 0;\n\n      // Extract battery level\n      const battery = telemetry[\"battery.level\"]?.value ?? 0;\n\n      // Extract timestamp\n      const timestamp = telemetry.timestamp?.value\n        ? telemetry.timestamp.value * 1000 // Convert to ms if in seconds\n        : telemetry.server?.timestamp?.value ?? Date.now();\n\n      // Extract additional telemetry fields\n      const additionalTelemetry: Record<string, any> = {};\n\n      // Map important telemetry fields\n      const telemetryMapping = {\n        \"position.altitude\": \"altitude\",\n        \"position.satellites\": \"satellites\",\n        \"position.hdop\": \"hdop\",\n        \"position.pdop\": \"pdop\",\n        \"battery.voltage\": \"battery_voltage\",\n        \"battery.current\": \"battery_current\",\n        \"engine.ignition.status\": \"ignition\",\n        \"gsm.signal.level\": \"gsm_signal\",\n        \"movement.status\": \"movement\",\n        \"external.powersource.voltage\": \"external_power\",\n        \"sleep.mode.enum\": \"sleep_mode\",\n      };\n\n      // Add mapped fields to additionalTelemetry\n      for (const [key, mappedName] of Object.entries(telemetryMapping)) {\n        if (telemetry[key]?.value !== undefined) {\n          additionalTelemetry[mappedName] = telemetry[key].value;\n        }\n      }\n\n      return {\n        id: vehicleId,\n        name,\n        lat,\n        lng,\n        speed,\n        battery,\n        timestamp,\n        heading,\n        additionalTelemetry,\n      };\n    }\n\n    // Fallback to basic position data\n    const vehiclesPositions = await getAllVehiclesPositions();\n    const vehiclePosition = vehiclesPositions.find((v) => v.id === vehicleId);\n\n    if (vehiclePosition) {\n      return {\n        id: vehiclePosition.id,\n        name: vehiclePosition.name,\n        lat: vehiclePosition.lat,\n        lng: vehiclePosition.lng,\n        speed: 0,\n        battery: 50,\n        timestamp: Date.now(),\n        heading: vehiclePosition.heading || 0,\n        additionalTelemetry: {},\n      };\n    }\n\n    // Last resort fallback\n    return {\n      id: vehicleId,\n      name: `Vehicle ${vehicleId}`,\n      lat: 32.220923,\n      lng: -7.929113,\n      speed: 0,\n      battery: 50,\n      timestamp: Date.now(),\n      heading: 0,\n      additionalTelemetry: {},\n    };\n  } catch (error) {\n    console.error(\"Error fetching vehicle details:\", error);\n\n    // Fallback to position data\n    const vehiclesPositions = await getAllVehiclesPositions();\n    const vehiclePosition = vehiclesPositions.find((v) => v.id === vehicleId);\n\n    if (vehiclePosition) {\n      return {\n        id: vehiclePosition.id,\n        name: vehiclePosition.name,\n        lat: vehiclePosition.lat,\n        lng: vehiclePosition.lng,\n        speed: 0,\n        battery: 50,\n        timestamp: Date.now(),\n        heading: vehiclePosition.heading || 0,\n        additionalTelemetry: {},\n      };\n    }\n\n    return {\n      id: vehicleId,\n      name: `Vehicle ${vehicleId}`,\n      lat: 32.220923,\n      lng: -7.929113,\n      speed: 0,\n      battery: 50,\n      timestamp: Date.now(),\n      heading: 0,\n      additionalTelemetry: {},\n    };\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1317, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/components/dashboard/VehiclesList.tsx"],"sourcesContent":["import { getVehicleDetails } from \"@/lib/api\";\nimport {\n  VehicleDetails as VehicleDetailsType,\n  VehiclePosition,\n} from \"@/types/vehicle\";\nimport {\n  Battery,\n  BatteryMedium,\n  Car,\n  ChevronDown,\n  Clock,\n  Gauge,\n  MapPin,\n  Navigation,\n  Zap,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\ninterface VehiclesListProps {\n  vehicles: VehiclePosition[];\n  selectedVehicleId: string | null;\n  onVehicleClick: (id: string) => void;\n  isLoading: boolean;\n}\n\nexport default function VehiclesList({\n  vehicles,\n  selectedVehicleId,\n  onVehicleClick,\n  isLoading,\n}: VehiclesListProps) {\n  const [selectedDropdownId, setSelectedDropdownId] = useState<string | null>(\n    null\n  );\n  const [sidebarVehicleDetails, setSidebarVehicleDetails] =\n    useState<VehicleDetailsType | null>(null);\n  const [isLoadingDetails, setIsLoadingDetails] = useState(false);\n\n  // Handle dropdown selection change\n  const handleDropdownChange = async (\n    e: React.ChangeEvent<HTMLSelectElement>\n  ) => {\n    const vehicleId = e.target.value;\n    if (vehicleId) {\n      setSelectedDropdownId(vehicleId);\n      await fetchVehicleDetails(vehicleId);\n    } else {\n      setSelectedDropdownId(null);\n      setSidebarVehicleDetails(null);\n    }\n  };\n\n  // Fetch vehicle details\n  const fetchVehicleDetails = async (vehicleId: string) => {\n    if (!vehicleId) return;\n\n    setIsLoadingDetails(true);\n    try {\n      const details = await getVehicleDetails(vehicleId);\n      setSidebarVehicleDetails(details);\n      console.log(\"Sidebar vehicle details fetched:\", details);\n    } catch (err) {\n      console.error(\"Failed to fetch sidebar vehicle details:\", err);\n    } finally {\n      setIsLoadingDetails(false);\n    }\n  };\n\n  // Set up periodic polling for the selected vehicle\n  useEffect(() => {\n    if (!selectedDropdownId) return;\n\n    // Initial fetch\n    fetchVehicleDetails(selectedDropdownId);\n\n    // Set up polling every 5 seconds\n    const intervalId = setInterval(() => {\n      fetchVehicleDetails(selectedDropdownId);\n    }, 10000);\n\n    return () => clearInterval(intervalId);\n  }, [selectedDropdownId]);\n\n  return (\n    <div className=\"p-4 h-full overflow-auto flex flex-col\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-lg text-white font-semibold\">Vehicle Details</h2>\n      </div>\n\n      {/* Vehicle Selector Dropdown */}\n      <div className=\"mb-4\">\n        <label\n          htmlFor=\"vehicleSelector\"\n          className=\"block text-sm font-medium text-gray-100 mb-1\"\n        >\n          Select Vehicle\n        </label>\n        <div className=\"relative\">\n          <select\n            id=\"vehicleSelector\"\n            className=\"block w-full pl-3 pr-10 py-2 text-base border border-gray-300 text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md\"\n            value={selectedDropdownId || \"\"}\n            onChange={handleDropdownChange}\n          >\n            <option value=\"\">Select a vehicle...</option>\n            {vehicles.map((vehicle) => (\n              <option key={vehicle.id} value={vehicle.id}>\n                {vehicle.name}\n              </option>\n            ))}\n          </select>\n          <div className=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700\">\n            <ChevronDown className=\"h-4 w-4\" />\n          </div>\n        </div>\n      </div>\n\n      {sidebarVehicleDetails ? (\n        <div className=\"space-y-4\">\n          {/* Vehicle Name Card */}\n          <div className=\"bg-white rounded-lg shadow p-4 border-l-4 border-blue-500\">\n            <div className=\"items-center justify-between\">\n              <div className=\"flex items-center text-black\">\n                <Car className=\"h-6 w-6 mr-3\" />\n                <h3 className=\"font-bold text-lg\">\n                  {sidebarVehicleDetails.name}\n                </h3>\n              </div>\n              <div className=\"text-xs text-gray-500 flex items-center\">\n                <Clock className=\"h-3 w-3 mr-1\" />\n                <span>\n                  {new Date(\n                    sidebarVehicleDetails.timestamp\n                  ).toLocaleTimeString()}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Location Card */}\n          <div className=\"bg-white rounded-lg shadow p-4\">\n            <h4 className=\"text-sm font-medium text-gray-700 mb-2 flex items-center\">\n              <MapPin className=\"h-4 w-4 mr-2 text-blue-500\" />\n              Location\n            </h4>\n            <div className=\"text-gray-800 font-medium\">\n              {sidebarVehicleDetails.lat.toFixed(6)},{\" \"}\n              {sidebarVehicleDetails.lng.toFixed(6)}\n            </div>\n            {sidebarVehicleDetails.heading !== undefined && (\n              <div className=\"mt-2 text-sm text-gray-600 flex items-center\">\n                <Navigation className=\"h-4 w-4 mr-1 text-gray-500\" />\n                <span>\n                  Heading: {Math.round(sidebarVehicleDetails.heading)}Â°\n                </span>\n              </div>\n            )}\n          </div>\n\n          {/* Speed Card */}\n          <div className=\"bg-white rounded-lg shadow p-4\">\n            <h4 className=\"text-sm font-medium text-gray-700 mb-2 flex items-center\">\n              <Gauge className=\"h-4 w-4 mr-2 text-blue-500\" />\n              Speed\n            </h4>\n            <div className=\"flex items-center\">\n              <div className=\"text-2xl font-bold text-gray-800\">\n                {sidebarVehicleDetails.speed}\n              </div>\n              <div className=\"ml-2 text-sm text-gray-600\">km/h</div>\n            </div>\n          </div>\n\n          {/* Battery Card */}\n          <div className=\"bg-white rounded-lg shadow p-4\">\n            <h4 className=\"text-sm font-medium text-gray-700 mb-2 flex items-center\">\n              <Battery className=\"h-4 w-4 mr-2 text-blue-500\" />\n              Battery Status\n            </h4>\n            <div className=\"flex items-center mb-2\">\n              <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\n                <div\n                  className={`h-2.5 rounded-full ${\n                    sidebarVehicleDetails.battery > 50\n                      ? \"bg-green-500\"\n                      : sidebarVehicleDetails.battery > 20\n                      ? \"bg-yellow-500\"\n                      : \"bg-red-500\"\n                  }`}\n                  style={{ width: `${sidebarVehicleDetails.battery}%` }}\n                ></div>\n              </div>\n              <span className=\"ml-2 text-sm font-medium text-gray-900\">\n                {sidebarVehicleDetails.battery}%\n              </span>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-2 mt-2\">\n              {sidebarVehicleDetails.additionalTelemetry?.battery_voltage !==\n                undefined && (\n                <div className=\"text-sm text-gray-600 flex items-center\">\n                  <BatteryMedium className=\"h-3 w-3 mr-1 text-gray-500\" />\n                  <span>\n                    {sidebarVehicleDetails.additionalTelemetry.battery_voltage}{\" \"}\n                    V\n                  </span>\n                </div>\n              )}\n\n              {sidebarVehicleDetails.additionalTelemetry?.battery_current !==\n                undefined && (\n                <div className=\"text-sm text-gray-600 flex items-center\">\n                  <Zap className=\"h-3 w-3 mr-1 text-gray-500\" />\n                  <span>\n                    {sidebarVehicleDetails.additionalTelemetry.battery_current}{\" \"}\n                    A\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      ) : selectedDropdownId ? (\n        <div className=\"bg-gray-50 rounded-lg p-8 text-center\">\n          <Car className=\"h-12 w-12 mx-auto text-gray-400 mb-3\" />\n          <p className=\"text-gray-500\">Loading vehicle data...</p>\n        </div>\n      ) : (\n        <div className=\"bg-gray-50 rounded-lg p-8 text-center\">\n          <Car className=\"h-12 w-12 mx-auto text-gray-400 mb-3\" />\n          <p className=\"text-gray-500\">\n            Please select a vehicle to view details\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1839, "column": 0}, "map": {"version":3,"sources":["file:///Users/yassineeddyb/projects/GEP/flespi-app/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport VehicleDetails from \"@/components/dashboard/VehicleDetails\";\nimport VehicleMap from \"@/components/dashboard/VehicleMap\";\nimport VehiclesList from \"@/components/dashboard/VehiclesList\";\nimport { getAllVehiclesPositions, getVehicleDetails } from \"@/lib/api\";\nimport {\n  VehicleDetails as VehicleDetailsType,\n  VehiclePosition,\n} from \"@/types/vehicle\";\nimport { useEffect, useRef, useState } from \"react\";\n\nexport default function Dashboard() {\n  const [vehicles, setVehicles] = useState<VehiclePosition[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Store previous positions to calculate heading\n  const prevPositionsRef = useRef<{\n    [id: string]: { lat: number; lng: number };\n  }>({});\n\n  // For vehicle details modal\n  const [isDetailsOpen, setIsDetailsOpen] = useState(false);\n  const [selectedVehicleId, setSelectedVehicleId] = useState<string | null>(\n    null\n  );\n  const [vehicleDetails, setVehicleDetails] =\n    useState<VehicleDetailsType | null>(null);\n  const [isDetailsLoading, setIsDetailsLoading] = useState(false);\n\n  // Calculate heading based on previous and current position\n  const calculateHeading = (\n    prevLat: number,\n    prevLng: number,\n    currLat: number,\n    currLng: number\n  ): number => {\n    // If the position hasn't changed, return 0 (or previous heading if available)\n    if (prevLat === currLat && prevLng === currLng) {\n      return 0;\n    }\n\n    // Calculate the angle in degrees from the positive y-axis (north)\n    // atan2 returns angle in radians from the positive x-axis\n    // We convert it to degrees and adjust to make north=0, east=90, etc.\n    const dx = currLng - prevLng;\n    const dy = currLat - prevLat;\n    let heading = Math.atan2(dx, dy) * (180 / Math.PI);\n\n    // Normalize to 0-360 range\n    return (heading + 360) % 360;\n  };\n\n  // Fetch all vehicles on component mount\n  useEffect(() => {\n    const fetchVehicles = async () => {\n      try {\n        setIsLoading(true);\n        setError(null);\n        const data = await getAllVehiclesPositions();\n\n        // Calculate heading for each vehicle by comparing with previous position\n        const updatedData = data.map((vehicle) => {\n          const prevPos = prevPositionsRef.current[vehicle.id];\n          let heading = vehicle.heading || 0; // Keep existing heading if present\n\n          if (prevPos) {\n            // Only calculate new heading if position has changed\n            if (prevPos.lat !== vehicle.lat || prevPos.lng !== vehicle.lng) {\n              heading = calculateHeading(\n                prevPos.lat,\n                prevPos.lng,\n                vehicle.lat,\n                vehicle.lng\n              );\n            }\n          }\n\n          // Update previous positions for next calculation\n          prevPositionsRef.current[vehicle.id] = {\n            lat: vehicle.lat,\n            lng: vehicle.lng,\n          };\n\n          return {\n            ...vehicle,\n            heading,\n          };\n        });\n\n        setVehicles(updatedData);\n      } catch (err) {\n        console.error(\"Failed to fetch vehicles:\", err);\n        setError(\"Failed to load vehicles. Please try again later.\");\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchVehicles();\n\n    // Set up polling for real-time updates (every 5 seconds)\n    const intervalId = setInterval(fetchVehicles, 10000);\n\n    return () => clearInterval(intervalId);\n  }, []);\n\n  // Handle vehicle selection\n  const handleVehicleClick = async (vehicleId: string) => {\n    console.log(\"Dashboard: handleVehicleClick called with ID:\", vehicleId);\n\n    // First set the dialog to open and indicate loading\n    setIsDetailsOpen(true);\n    setSelectedVehicleId(vehicleId);\n    setIsDetailsLoading(true);\n\n    try {\n      // Then fetch the vehicle details\n      const details = await getVehicleDetails(vehicleId);\n      console.log(\"Dashboard: Vehicle details fetched:\", details);\n      setVehicleDetails(details);\n    } catch (err) {\n      console.error(\"Failed to fetch vehicle details:\", err);\n    } finally {\n      setIsDetailsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col min-h-screen bg-black\">\n      <main className=\"flex-1 flex flex-col md:flex-row\">\n        {/* Left sidebar - Vehicle list */}\n        <div className=\"w-full md:w-80 \">\n          <VehiclesList\n            vehicles={vehicles}\n            selectedVehicleId={selectedVehicleId}\n            onVehicleClick={handleVehicleClick}\n            isLoading={isLoading}\n          />\n        </div>\n\n        {/* Main content - Map */}\n        <div className=\"flex-1 p-4\">\n          {isLoading && !vehicles.length ? (\n            <div className=\"h-[calc(100vh-140px)] w-full bg-neutral-100 animate-pulse rounded-lg\"></div>\n          ) : error ? (\n            <div className=\"h-[calc(100vh-140px)] w-full flex items-center justify-center border border-red-200 bg-red-50 rounded-lg\">\n              <p className=\"text-red-500\">{error}</p>\n            </div>\n          ) : vehicles.length === 0 ? (\n            <div className=\"h-[calc(100vh-140px)] w-full flex items-center justify-center border border-neutral-200 bg-neutral-50 rounded-lg\">\n              <p className=\"text-neutral-500\">No vehicles found</p>\n            </div>\n          ) : (\n            <VehicleMap\n              vehicles={vehicles}\n              onVehicleClick={handleVehicleClick}\n            />\n          )}\n        </div>\n      </main>\n\n      <VehicleDetails\n        isOpen={isDetailsOpen}\n        onClose={() => {\n          setIsDetailsOpen(false);\n          setVehicleDetails(null);\n        }}\n        vehicleDetails={vehicleDetails}\n        isLoading={isDetailsLoading}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}